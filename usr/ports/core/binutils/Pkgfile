# Description: The GNU Binutils are a collection of binary tools
# URL:         http://sources.redhat.com/binutils/
# Maintainer:  CRUX System Team, core-ports at crux dot nu
# Depends on:  zlib

name=binutils
version=2.24
release=1
source=(ftp://ftp.gnu.org/gnu/$name/$name-$version.tar.bz2
	$name-$version-load_gcc_lto_plugin_by_default-1.patch
	$name-$version-ld-corrupted-list.patch)

build() {
    # Patch prevents hang of ld when passed -pie -static
    # This happened during configure of some other applications
    # Patch came from GIT and can be removed with 2.25
    patch -d $name-$version -Np1 -i $SRC/$name-$version-ld-corrupted-list.patch

    patch -d $name-$version -Np1 -i $SRC/$name-$version-load_gcc_lto_plugin_by_default-1.patch

    mkdir build
    cd build
    ../$name-$version/configure --prefix=/usr \
                                --mandir=/usr/man \
                                --enable-shared \
                                --disable-nls \
				--disable-werror
    make tooldir=/usr
    make check
    make tooldir=/usr DESTDIR=$PKG install
    rm -r $PKG/usr/share
    sed -i "s|-L$SRC[^ ]* ||g" $PKG/usr/lib/libbfd.la
}
