# Description: Keytable files and keyboard utilities
# URL:         ftp://ftp.win.tue.nl/pub/linux-local/utils/kbd/
# Maintainer:  CRUX System Team, core-ports at crux dot nu

name=kbd
version=2.0.1
release=1
source=(ftp://ftp.altlinux.org/pub/people/legion/kbd/$name-$version.tar.gz
	kbd-2.0.1-backspace-1.patch)

build() {
    cd $name-$version
    patch -Np1 < ../kbd-2.0.1-backspace-1.patch

    # Disable check requirement and tests, since we won't run them now
    sed -i -e '/\[CHECK\]/d' configure.ac
    sed -i -e 's/SUBDIRS = \(.*\) tests \(.*\)/SUBDIRS = \1 \2/' Makefile.am
    autoreconf -fiv

    ./configure --prefix=/usr \
                --mandir=/usr/man \
                --datadir=/usr/share/kbd \
                --disable-vlock \
                --disable-nls
    make -j1
    make DESTDIR=$PKG install

    ln -sf default8x16.psfu.gz $PKG/usr/share/kbd/consolefonts/default.gz

    rm -r $PKG/usr/share/kbd/keymaps/{ppc,mac,atari,amiga,sun}
    rm $PKG/usr/bin/{loadunimap,mapscrn,resizecons,psf*table}
    rm $PKG/usr/man/man8/{loadunimap,mapscrn,resizecons}.8
    rm $PKG/usr/man/man1/psf*table.1
    find $PKG/usr/share/kbd/ -type f -name "README*" -delete
}
