# Description: Thinstation essential package
# URL: http://www.thinstation.org
# Maintainer: Donald A. Cupp Jr. (don cupp jr at ya hoo dot com)

name=lightdm
version=1.9.3
release=1
source=(https://launchpad.net/$name/${version%.*}/$version/+download/$name-$version.tar.xz
	lightdm-1.2.2-nodaemon_option.patch
	lightdm-lock-screen-before-switch.patch
	lightdm.pam
	lightdm-autologin.pam
	lightdm-tmpfiles.conf
	lightdm.rules
	lightdm.service
)

build() {
	cd $name-$version

	patch -p1 -i $SRC/lightdm-1.2.2-nodaemon_option.patch
	patch -p1 -i $SRC/lightdm-lock-screen-before-switch.patch

	./configure --prefix=/usr \
			--localstatedir=/var \
			--sysconfdir=/etc \
			--mandir=/usr/man \
			--disable-introspection \
			--disable-tests \
			--disable-liblightdm-qt \
			--disable-liblightdm-qt5 \
			--disable-gtk-doc \
			--disable-gtk-doc-html \
			--disable-gtk-doc-pdf \
			--disable-nls



	make
	make DESTDIR=$PKG install

	rm -rfv $PKG/etc/apparmor.d/

	mkdir -p $PKG/usr/share/lightdm/remote-sessions
	mkdir -p $PKG/var/cache/lightdm/
	mkdir -p $PKG/var/run/lightdm/authority
	mkdir -p $PKG/var/log/lightdm
	mkdir -p $PKG/var/lib/lightdm
	install -Dpm 644 $SRC/lightdm.pam $PKG/etc/pam.d/lightdm
	install -Dpm 644 $SRC/lightdm-autologin.pam $PKG/etc/pam.d/lightdm-autologin
#	install -Dpm 644 $SRC/lightdm-tmpfiles.conf $PKG/usr/lib/tmpfiles.d/lightdm.conf
#	install -m644 -p -D $SRC/lightdm.service $PKG/lib/systemd/system/lightdm.service
	install -m644 -p -D $SRC/lightdm.rules $PKG/usr/share/polkit-1/rules.d/lightdm.rules

}
